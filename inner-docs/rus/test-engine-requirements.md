# Требования к движку тестирования

## Должен уметь всё (или хотя бы 95% от) то, что написано в тест кейсах для ручных тестировщиков

###  Шаги - действия со страницей.

* Позволяет ли выбрать значение в комбобоксе, внутри которого дерево с раскрывающимися элементами.

* Что если в гриде надо сменить режим фильтрации, или добавить/убрать отображаемые столбцы.
Для этого надо вызвать меню хэдера грида, выбрать там нужную строку, и т.д.

### Делать проверки, которые сейчас делаются глазами

* Проверить значение в столбце "Уровень критичности" в гриде инцидентов,
в строке с id инцидента таким-то.
При том, что этот уровень критичности изображен как картинка.

### Установка необходимых пререквизитов и пресетов БД

* Проверить, что Web элементы находятся в определённых состояниях и содержат (комбобоксы)
внутри себя нужные значения.

* Быстро и удобном изменить или подменить БД в приложении.

* Перезапустить приложение, опционально почистив профайл браузера.

## Должен быть надёжным, т.е. решать следующие проблемы:

### По поиску элементов

* HTML id в ExtJs приложении могут с большой вероятностью меняться при **перезапуске приложения**,
не говоря уже о **пересборке**.
* CSS классы могут меняться при выпуске **новых версий ExtJs**.

### По доступности элементов

* Элемент может быть визуально видимым на странице, но ещё не иметь внутреннего наполнения,
т.к. подгружает свои данные AJAX запросами, или обрабатывает событие.
* И движок не должен решать это за счёт тупых таймаутов.

## Написание и поддержка тестов должны быть быстрыми

### Не более 5-10 секунд на написание надёжного кода по идентификации одного элемента

Если вам ради доступа к каждому элементу нужно:

* инспектировать страницу,
* вычленять подходящий XPath,
* думать насколько он уникальный и надежный,
* и вы на каждый контрол тратите 5 минут,
* а ваш мозг за час превращается в недееспособную кашу,
* а при следующем запуске/сборке/смене ExtJs версии вы понимаете, что ошиблись в своих предположениях,

значит движок тестирования нам не подходит.

### Быстрая отладка тестов

* Должна быть возможность запустить код теста с учётом текущего состояния Web страницы в браузере.

* Перезапуск теста должен занимать не более 5 секунд.
Если для перезапуска теста надо перезапустить webdriver, переоткрыть браузер, залогиниться (а с чистым профайлом,
который по умолчанию используют webdrivers, ваши кэши и куки пропали, и перелогин неизбежен),
то будет уходить секунд 40.

### API должно быть хорошо быть хорошо задокументировано.

* Должна быть документация с возможностью поиска.
* **Должна быть система автодополнений и показа документации в IDE**.
* Должны быть примеры использования.
* Должна быть документация по терминам, и воркфлоу работы в разных ситуациях
(боевой режим, отладка, написание тестов)

* Хорошо бы иметь и скринкасты на youtube.

### Intellisense & autocompletion

* **В IDE должны быть autocompletion и всплывающие подсказки по функциям и свойствам объектов API**.

### Язык программирования должен быть знакомым

* Например **JavaScript** мы знаем в совершенстве, т.к. у нас и фронт и бэк на JavaScript.

### Установка движка должна быть быстрой, движок должен быть легковесным и быстрым

* Java проект, тянущий за собой 20 GB зависимостей, и не способный работать на виртуальной машине
с 8 GB оперативки, вряд ли нам подойдёт.

### При изменении в приложении изменение автотестов должно быть быстрым.

* В идеале это просто ревью изменений в тестовых логах, апдейт эталонных логов и коммит их в git.

### Должна быть возможность гонять тесты с задержкой на каждом действии

* Чтобы глазом можно было успеть отследить что делает тест, и сравнить его с действиями в тест кейсе.

### Должен выдавать отладочный трейсинг

* Чтобы отслеживать что происходит внутри движка и внутри тестов.

### Должен мониторить ресурсы
 
 * И выдавать предупреждения в логе, если при этом тесте приложение отнимает больше
ресурсов, чем задумано.

### Должен иметь возможность пропускать какие-то тесты

* И ещё должен как-то удобно обрабатывать временные дифы (для тестов, где фикс в процессе).

## Должен иметь логичную структуру тест сьютов

* Код и логи автотестов должны лежать в репозитории как можно ближе к тому коду приложения,
который эти автотесты проверяют.

## Должен выдавать понятные результаты

* Есть тест план, с 100500 тестами. Движок должен давать возможность прогнать тесты,
быстро определить сколько тестов прошло нормально, сколько сломано, какие тесты сломались
и показать что именно сломано.

* **В идеале и код и лог тестов должны выглядеть как текст тест кейса в тест ране**.

* Результаты в удобном виде должны посылаться в slack и на электронную почту (с логами сломанных тестов в аттачментах).

* Для разбора ошибок, должна быть возможность посмотреть как менялись ожидаемые результаты
от версии к версии продукта.

## Тесты должны быть быстрыми

* Если каждый тест работает на новом профайле браузера - то чисто на логин будет уходить
30 секунд.

* Должна быть возможность сохранять браузер между тестами (а не открывать/закрывать его на каждом тесте).

## Быть кросс-платформенным

* Linux (CentOS/Ubuntu)
* MacOS
* Windows

## Хорошо поддерживать многоязычность приложения

* В идеале, ничего в тестах и логах не должно меняться при переходе с русской на английскую версию.

## Не затачиваться на один вид сборки

* То, что работает в development сборке, должно работать и в production.
ExtJs называет некоторые контролы по разному в разных видах сборки.

## Не затачиваться на один HTTP адрес

* Если в автотест работал для http://10.4.3.x, и мы переставим приложение на https://10.4.3.y,
тесты должны отработать без ошибок и без изменений в логах тестов.

## Поддерживать наши основные браузеры

* Chrome
* Firefox
* IE/Edge

### Поддерживать headless режимы этих браузеров, чтобы можно было гонять тесты на системах без GUI.

### Поддерживать считывание ошибок из консоли браузера в тестовый лог.

## Интегрироваться с Jira и Test rails

* Поддерживать теги. Чтобы оценивать покрытие по фичам. И понимать в каком автотесте какая Jira задача тестируется.

## Иметь большой набор настроек

* Чтобы включать / отключать возможности движка.

## Работать с серверными логами нашего приложения

* Предоставлять их при сломанных тестах.

## Работать с логами зависимостей (например PostgreSQL, NATS, Node.Js, npm модули).

* Предоставлять их при сломанных тестах.

## Работать с системами мониторинга ресурсов

* Т.е. отслеживать свободное место на диске и в памяти, другие ресурсы системы.
Предоставлять их при сломанных тестах.

## Оценивать покрытие кода

## Встраиваться в системы Continuous Integration

## Быть динамично развивающимся, чтобы быстро фиксились баги и впиливались наши хотелки

## Иметь быструю и отзывчивую поддержку

## Стоить разумные деньги, или быть бесплатным с подходящей лицензией

## Если в движке что-то из вышеперечисленного не поддерживается, то стоит оценить насколько быстро оно там может появиться

# Ссылки, освещающие проблемы связки WebDriver + ExtJs:

* http://swtestnextstep.blogspot.com/2015/10/selenium-and-extjs.html
* https://stackoverflow.com/questions/107314/any-suggestions-for-testing-extjs-code-in-a-browser-preferably-with-selenium
* https://habr.com/ru/post/181660/
* https://www.youtube.com/watch?time_continue=5&v=3RJldtSEl9k
* https://yizeng.me/2017/01/15/tips-for-locating-elements-in-ext-js-applications-with-selenium-webdriver/
* https://sqa.stackexchange.com/questions/8882/testing-extjs-ui-with-webdriver
* https://joaoschmitt.wordpress.com/2017/07/29/automated-testing-in-java-and-node-js-with-selenium-and-extjs-6-5/
* https://groups.google.com/forum/#!topic/selenium-users/wdgeOzW1ysM
* https://thecancerus.com/testing-extjs-application-with-selenium-few-pointers/
* https://www.outbrain.com/techblog/2011/12/how-to-outbrain-selenium-tests-with-ext-framework/
* https://automated-testing.info/t/selenium-extjs/1544
* https://habr.com/ru/post/141165/
* https://habr.com/ru/post/192742/
